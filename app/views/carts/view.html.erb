<style>
	td{
		padding: 1%;
	}
	.cart-div{
		overflow: scroll;
	}
	.cart-div::-webkit-scrollbar{
	  display: none;
	}
	.formRow{
		margin-top: 5%;
	}
	table{
		width: 778px;
	}
	thead tr td{
		padding: 1%;
	}
	.green{
		color: green;
	}
	.quant{
		width: 45px
	}
	.btn-danger{
		margin-top: 3%;
	}
	.cartRow .btn{
		width: 142px;
	}
	.cartRow{
		display: block;
	}
	.cell{
		display: inline-block;
	    width: 120px;
	    margin: 1%;
	    vertical-align: top;
	}
	form{
		display: inline;
	}
	.cartTable{
		height: 810px;
		overflow: scroll;
	}
</style>
<div class="table-responsive cart-div">
	<% if @c.products.empty? %>
	<h2>Your Cart is Empty</h2>
	<% else %>
	<h1>Your Cart</h1>
	<div class="cartTable">
			<div class="cartRow">
				<span class="cell">Name</span>
				<span class="cell">Manufacturer</span>
				<span class="cell">Manufacturer Number</span>
				<span class="cell">Distributor</span>
				<span class="cell">Price</span>
				<span class="cell">Quantity</span>
				<span class="cell">Action</span>
			</div>
			<% @total = 0 %>
			<% @c.products.each do |p| %>
			<% min = (p.price.to_f * p.quantity).round(2) %>
			<% p.prices.each do |r| %>
				<% if (r.price.to_f * p.quantity).round(2) < min %>
				<% min = (r.price.to_f * p.quantity).round(2) %>
				<% end %>
			<% end %>
			<div class="cartRow bg-info">
			<span class="cell"><a href='/products/<%= p.distributor_number %>/<%= p.name %>/<%= p.manufacturer %>/<%= p.manufacturer_number %>'><%= p.name %></a></span>
			<span class="cell"><%= p.manufacturer %></span>
			<span class="cell"><%= p.manufacturer_number %></span>
			<span class="cell"><%= p.distributor %></span>
			<% current = p.distributor %>
			<% if p.price == nil or p.quantity == nil %>
			<% else %>
			<% @finalPrice = (p.price.to_f * p.quantity).round(2) %>
			<% @total += @finalPrice %>
			<% if min == (p.price.to_f * p.quantity).round(2) %>
			<span class="cell"><span class="green">$<%= number_with_precision(p.price.to_f * p.quantity.to_i, :precision => 2) %></span></span>
			<% else %>
			<span class="cell">$<%= number_with_precision(p.price.to_f * p.quantity.to_i, :precision => 2) %></span>
			<% end %>
			<% end %>
			<form method="post" action="carts/<%= p.id %>">
			<input name="authenticity_token" value="<%= form_authenticity_token %>" type="hidden">
          	<input type="hidden"name="_method" value="patch">
			<span class="cell"><input type="number" name="quantity" value="<%= p.quantity %>" class="quant" min="1"></span>
			<span class="cell"><input type="submit" value="Update Quantity" class="btn btn-primary btn-sm">
			</form>
			<form method="post" action="carts/<%= p.id %>">
			<input name="authenticity_token" value="<%= form_authenticity_token %>" type="hidden">
			<input type='hidden' name='_method' value='delete'>
			<input type="submit" value="Remove Item" class="btn btn-danger btn-sm">
			</form>
			</span>
			</div>
			<% p.prices.each do |r| %>
			<div class="cartRow">
				<% if r.distributor == '1' && current != 'Patterson Dental'%>
				<span class="cell"></span>
				<span class="cell"></span>
				<span class="cell"></span>
					<span class="cell">Patterson Dental</span>
					<% if min == (r.price.to_f * p.quantity).round(2) %>
					<span class="cell"><span class="green">$<%= number_with_precision(r.price.to_f * p.quantity.to_i, :precision => 2) %></span></span>
					<% else %>
					<span class="cell">$<%= number_with_precision(r.price.to_f * p.quantity.to_i, :precision => 2) %></span>
					<% end %>
			<form method="post" action="dist_change/<%= p.id %>">
			<input name="authenticity_token" value="<%= form_authenticity_token %>" type="hidden">
          	<input type="hidden"name="_method" value="patch">
          	<input type="hidden" name="price" value="<%= r.price %>">
          	<input type="hidden" name="distributor" value="Patterson Dental">
			<span class="cell"><input type="number" name="quantity" value="<%= p.quantity %>" class="quant" min="1"></span>
			<span class="cell"><input type="submit" value="Change Distributor" class="btn btn-primary btn-sm"></span>
			</form>
				<% elsif r.distributor == '2' && current != 'Safco Dental'%>
				<span class="cell"></span>
				<span class="cell"></span>
				<span class="cell"></span>
					<span class="cell">Safco Dental</span>
					<% if min == (r.price.to_f * p.quantity).round(2) %>
					<span class="cell"><span class="green">$<%= number_with_precision(r.price.to_f * p.quantity.to_i, :precision => 2) %></span></span>
					<% else %>
					<span class="cell">$<%= number_with_precision(r.price.to_f * p.quantity.to_i, :precision => 2) %></span>
					<% end %>
			<form method="post" action="dist_change/<%= p.id %>">
			<input name="authenticity_token" value="<%= form_authenticity_token %>" type="hidden">
          	<input type="hidden"name="_method" value="patch">
          	<input type="hidden" name="price" value="<%= r.price %>">
          	<input type="hidden" name="distributor" value="Safco Dental">
			<span class="cell"><input type="number" name="quantity" value="<%= p.quantity %>" class="quant" min="1"></span>
			<span class="cell"><input type="submit" value="Change Distributor" class="btn btn-primary btn-sm"></span>
			</form>
				<% elsif r.distributor == '3'  && current != 'Darby Dental'%>
				<span class="cell"></span>
				<span class="cell"></span>
				<span class="cell"></span>
					<span class="cell">Darby Dental</span>
					<% if min == (r.price.to_f * p.quantity).round(2) %>
					<span class="cell"><span class="green">$<%= number_with_precision(r.price.to_f * p.quantity.to_i, :precision => 2) %></span></span>
					<% else %>
					<span class="cell">$<%= number_with_precision(r.price.to_f * p.quantity.to_i, :precision => 2) %></span>
					<% end %>
			<form method="post" action="dist_change/<%= p.id %>">
			<input name="authenticity_token" value="<%= form_authenticity_token %>" type="hidden">
          	<input type="hidden"name="_method" value="patch">
          	<input type="hidden" name="price" value="<%= r.price %>">
          	<input type="hidden" name="distributor" value="Darby Dental">
			<span class="cell"><input type="number" name="quantity" value="<%= p.quantity %>" class="quant" min="1"></span>
			<span class="cell"><input type="submit" value="Change Distributor" class="btn btn-primary btn-sm"></span>
			</form>
				<% elsif r.distributor == '4'  && current != 'Henry Schein'%>
				<span class="cell"></span>
				<span class="cell"></span>
				<span class="cell"></span>
					<span class="cell">Henry Schein</span>
					<% if min == (r.price.to_f * p.quantity).round(2) %>
					<span class="cell"><span class="green">$<%= number_with_precision(r.price.to_f * p.quantity.to_i, :precision => 2) %></span></span>
					<% else %>
					<span class="cell">$<%= number_with_precision(r.price.to_f * p.quantity.to_i, :precision => 2) %></span>
					<% end %>
			<form method="post" action="dist_change/<%= p.id %>">
			<input name="authenticity_token" value="<%= form_authenticity_token %>" type="hidden">
          	<input type="hidden"name="_method" value="patch">
          	<input type="hidden" name="price" value="<%= r.price %>">
          	<input type="hidden" name="distributor" value="Henry Schein">
			<span class="cell"><input type="number" name="quantity" value="<%= p.quantity %>" class="quant" min="1"></span>
			<span class="cell"><input type="submit" value="Change Distributor" class="btn btn-primary btn-sm"></span>
			</form>
				<% elsif r.distributor == '5'  && current != 'Benco Dental'%>
				<span class="cell"></span>
				<span class="cell"></span>
				<span class="cell"></span>
					<span class="cell">Benco Dental</span>
					<% if min == (r.price.to_f * p.quantity).round(2) %>
					<span class="cell"><span class="green">$<%= number_with_precision(r.price.to_f * p.quantity.to_i, :precision => 2) %></span></span>
					<% else %>
					<span class="cell">$<%= number_with_precision(r.price.to_f * p.quantity.to_i, :precision => 2) %></span>
					<% end %>
			<form method="post" action="dist_change/<%= p.id %>">
			<input name="authenticity_token" value="<%= form_authenticity_token %>" type="hidden">
          	<input type="hidden"name="_method" value="patch">
          	<input type="hidden" name="price" value="<%= r.price %>">
          	<input type="hidden" name="distributor" value="Benco Dental">
			<span class="cell"><input type="number" name="quantity" value="<%= p.quantity %>" class="quant" min="1"></span>
			<span class="cell"><input type="submit" value="Change Distributor" class="btn btn-primary btn-sm"></span>
			</form>
				<% end %>
			</div>
			<% end %>
			<% end %>
			<div class="cartRow formRow">
				<span class="cell"></span>
				<span class="cell"></span>
				<span class="cell"></span>
				<span class="cell"></span>
				<span class="cell"></span>
				<span class="cell">Total: <span class="green"><%= number_to_currency(@total) %></span></span>
				<span class="cell">
					<form action="/checkout" method="post">
					<input name="authenticity_token" value="<%= form_authenticity_token %>" type="hidden">
					<input name="id" value="<%= @c.id %>" type="hidden">
					<input type="submit" value="Check Out" class="btn btn-primary btn-sm">
					</form>
				</span>
			</div>
</div>
<% end %>
</div>
